<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8"/>
    <meta http-equiv="x-ua-compatible" content="ie=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>{{title}}</title>
    {% if description %}
      <meta name="description" content="{{description}}"/>
    {% endif %}
    {% block head %}{% endblock %}
    <link rel="stylesheet" type="text/css" href="/static/css/style.css"/>
    {% if prism == true %}
      <link rel="stylesheet" type="text/css" href="/static/css/prism-tomorrow.css"/>
    {% endif %}
    <script>
      function storageAvailable(type) {
        var storage;
        try {
          storage = window[type];
          var x = '__storage_test__';
          storage.setItem(x, x);
          storage.removeItem(x);
          return true;
        } catch (e) {
          return e instanceof DOMException && (
          // everything except Firefox
          e.code === 22 ||
          // Firefox
          e.code === 1014 ||
          // test name field too, because code might not be present
          // everything except Firefox
          e.name === 'QuotaExceededError' ||
          // Firefox
          e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
          // acknowledge QuotaExceededError only if there's something already stored
          (storage && storage.length !== 0);
        }
      }

      const themeKey = 'andybond.dev-theme';
      const available = storageAvailable('localStorage');
      const system = window
        .matchMedia('(prefers-color-scheme: dark)')
        .matches;
      let dark = system;

      if (available) {
        dark = localStorage.getItem(themeKey) === 'dark';
      }

      if (dark) {
        document
          .documentElement
          .classList
          .add('dark');
      } else {
        document
          .documentElement
          .classList
          .remove('dark');
      }

      if (available) {
        localStorage.setItem(
          themeKey, dark
          ? 'dark'
          : 'light');
      }

      function toggleTheme() {
        document
          .documentElement
          .classList
          .toggle('dark');
        if (available) {
          const current = localStorage.getItem(themeKey);
          localStorage.setItem(
            themeKey, current === 'dark'
            ? 'light'
            : 'dark');
        }
      }
    </script>
  </head>
  <body>
    {% include "./partials/navbar.html" %}
    {{ content | safe }}
    {% include "./partials/footer.html" %}

    <script src="/static/js/alpine.js"></script>

    {% if path == "home" %}
      <!-- Netlify Identity Widget -->
      <!-- Needed only if you are using Netlify Identity feature -->
      <script type="text/javascript" src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    {% endif %}
  </body>
</html>
